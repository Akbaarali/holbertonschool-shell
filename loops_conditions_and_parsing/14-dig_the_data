#!/usr/bin/env bash
# Groups visitors by IP and HTTP status code, then prints occurrences sorted descending.

awk '
{
  ip = $1
  code = $9

  # Keep only valid looking values
  if (ip != "" && code ~ /^[0-9][0-9][0-9]$/) {
    key = ip " " code
    count[key]++
  }
}
END {
  for (k in count) {
    print count[k], k
  }
}
' apache-access.log | sort -rn -k1,1
