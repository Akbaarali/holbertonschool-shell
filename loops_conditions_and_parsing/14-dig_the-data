#!/usr/bin/env bash
# Display the number of occurrences of each (IP, HTTP status code) pair in apache-access.log

awk '
$1 ~ /^[0-9][0-9]*\.[0-9][0-9]*\.[0-9][0-9]*\.[0-9][0-9]*$/ && $9 ~ /^[0-9][0-9][0-9]$/ {
  n = split($1, a, /\./)
  if (n == 4) {
    ipkey = sprintf("%03d.%03d.%03d.%03d", a[1], a[2], a[3], a[4])
    print $1, $9, ipkey
  }
}
' apache-access.log \
| sort -k3,3 -k1,1 -k2,2n \
| uniq -c \
| sort -k1,1nr -k4,4 -k2,2n \
| awk '{ printf "%5d %s %s\n", $1, $2, $3 }'
